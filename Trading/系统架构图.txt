Trading System 系统架构图
================================================================================

1. 系统整体架构
================================================================================

┌─────────────────────────────────────────────────────────────────────────────┐
│                              Trading System                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐  │
│  │   主运行    │    │   数据准备   │    │   持仓构建   │    │   数据保存   │  │
│  │running_main │    │data_prepared│    │holding_     │    │portfolio_   │  │
│  │             │    │             │    │construct    │    │saving       │  │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘  │
│         │                   │                   │                   │      │
│         └───────────────────┼───────────────────┼───────────────────┘      │
│                             │                   │                          │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐  │
│  │   交易处理   │    │   宣夜交易   │    │   仁睿交易   │    │   交易检查   │  │
│  │trading_order│    │trading_order│    │trading_order│    │trading_check│  │
│  │_processing  │    │_xuanye      │    │_renrui      │    │             │  │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                             全局配置模块                                    │
│                        global_setting/global_dic                           │
└─────────────────────────────────────────────────────────────────────────────┘

2. 数据流向架构
================================================================================

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   配置文件   │    │   全局配置   │    │   数据准备   │    │   持仓构建   │
│trading_path │───▶│global_dic   │───▶│data_prepared│───▶│holding_     │
│_config.json │    │             │    │             │    │construct    │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
                                                                    │
┌─────────────┐    ┌─────────────┐    ┌─────────────┐            │
│   数据保存   │◀───│   交易订单   │◀───│   交易处理   │◀───────────┘
│portfolio_   │    │  生成       │    │trading_order│
│saving       │    │             │    │_processing  │
└─────────────┘    └─────────────┘    └─────────────┘

3. 模块依赖关系
================================================================================

┌─────────────────┐
│   running_main  │ (主入口)
└─────────┬───────┘
          │
    ┌─────┴─────┐
    │           │
┌───▼───┐   ┌───▼───┐
│Portfolio│   │Trading│
│Saving  │   │Order  │
└───┬───┘   └───┬───┘
    │           │
    │       ┌───▼───┐
    │       │trading│
    │       │_xuanye│
    │       └───┬───┘
    │           │
    │       ┌───▼───┐
    │       │trading│
    │       │_renrui│
    │       └───────┘
    │
┌───▼───┐
│data_  │
│prepared│
└───┬───┘
    │
┌───▼───┐
│holding│
│_construct│
└───────┘

4. 交易订单生成架构
================================================================================

┌─────────────────────────────────────────────────────────────────────────────┐
│                             交易订单生成流程                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐  │
│  │   目标权重   │    │   当前持仓   │    │   市场数据   │    │   资金信息   │  │
│  │productTarget│    │productHolding│    │mktData      │    │productInfo  │  │
│  │Weight       │    │             │    │             │    │             │  │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘  │
│         │                   │                   │                   │      │
│         └───────────────────┼───────────────────┼───────────────────┘      │
│                             │                   │                          │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐  │
│  │   持仓构建   │    │   资金重平衡  │    │   差异计算   │    │   订单生成   │  │
│  │holding_     │    │stockmoney_  │    │difference   │    │trading_order│  │
│  │construct    │    │rebalance    │    │             │    │             │  │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

5. 数据保存架构
================================================================================

┌─────────────────────────────────────────────────────────────────────────────┐
│                             数据保存流程                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐  │
│  │   组合信息   │    │   组合持仓   │    │   产品权重   │    │   产品持仓   │  │
│  │PortfolioInfo│    │Portfolio    │    │ProductWeight│    │Product      │  │
│  │             │    │Holding      │    │             │    │Holding      │  │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘  │
│         │                   │                   │                   │      │
│         └───────────────────┼───────────────────┼───────────────────┘      │
│                             │                   │                          │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐  │
│  │   SQL数据库  │    │   本地文件   │    │   配置文件   │    │   日志文件   │  │
│  │sqlSaving    │    │CSV/Excel    │    │JSON/YAML    │    │Log Files    │  │
│  │             │    │             │    │             │    │             │  │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

================================================================================
